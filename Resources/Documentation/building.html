<html>
<body link=black hlink=black vlink=black>

<!----------------------------- TITLE ------------------------->

<center>
<img src="banner.jpg">
</center>

<center>
<br/><br/>
<h2>Building</h2>
</center>

<!----------------------------- CONTENT ------------------------->

<blockquote>

First, download the source code from the <A href="http://sourceforge.net/project/showfiles.php?group_id=186987">sourceforge downloads area</A> or from SVN.<br/>
Aria is written in C++.
<br/><br/><b>Dependencies : </b>
<list>
<li/> <a href="http://www.wxwidgets.org">wxWidgets</A>. I am currently using 2.8.x.
<li/> <a href="http://www.opengl.org">OpenGL</A> and GLUT (included by default on mac OS X)
<li/> <a href="http://www.jdkoftinoff.com/main/Free_Projects/C++_MIDI_Library/"> libjdkmidi</A> (included in the Aria source)
<li/> <a href="http://www.ambiera.com/irrxml/index.html">irrXML</A> (included in the Aria source)
</list>

<br/><b>Build system : </b>
<list>
<li/> <a href="http://www.scons.org/">scons</A> (included in source tarballs. To build from SVN, install scons 0.98 or better)
<li/> You can also build with your favorite IDE/build system, but you'll then need to set up things yourself.
</list><br/>

<center><b>Prerequisites - Mac OS X</b></center>
You will need to install Developer Tools from the mac OS X install disc. You need OS X 10.4.<br/><br/>

<center><b>Prerequisites - Linux</b></center>
<br/>The Linux version has been tested less than the mac one but appears to be getting more stable. At this point, you might want to build it to help me test it - it might also be stable enough for production but no promise :).<br/>
<br/>You will need Python, Alsa (including -dev packages if your distro uses them), wxGTK (wxWidgets), OpenGL (if you wish to use the OpenGL renderer, and also get -dev packages if any), gcc/g++ (build-essential in Ubuntu). For midi playback, you will need a softsynth like Timidity with a soundbank (more info below)<br/><br/>

<center><b>Installing wxWidgets - Mac OS X</b></center><br/>

First, download and install wxWidgets. I usually build static. Don't forget to enable OpenGL support. In order to get proper Unified ToolBar support, you will need to patch wxWidgets as follows :
<pre>
--- wxMac-2.8.9/src/mac/carbon/toolbar.cpp	2008-09-15 05:39:33.000000000 -0400
+++ wxMac-2.8.9/src/mac/carbon/toolbar.cpp	2008-12-23 13:51:16.000000000 -0500
@@ -1200,6 +1200,11 @@
             {
                 // since setting the help texts is non-virtual we have to update
                 // the strings now
+
+                wxString label = tool->GetLabel();
+                HIToolbarItemSetLabel( hiItemRef , wxMacCFStringHolder(label, enc) );
+                
                 HIToolbarItemSetHelpText( hiItemRef,
                     wxMacCFStringHolder( tool->GetShortHelp(), enc ),
                     wxMacCFStringHolder( tool->GetLongHelp(), enc ) );
</pre>

Furthermore, the print dialog in wxWidgets has a bug, it will show 9999 as the number of pages no matter what. To fix this, apply the following patch (this was taken in SVN version of wxWidgets. The same fix works on wx 2.8.x but you will need to apply the changes manually since this patch won't work there. In wx 2.8, the file to patch is instead src/mac/carbon/printmac.cpp).
<pre>
Index: src/osx/core/printmac.cpp
===================================================================
--- src/osx/core/printmac.cpp (revision 57516)
+++ src/osx/core/printmac.cpp (working copy)
@@ -468,11 +468,24 @@
         return false;
 
     printout->SetIsPreview(false);
+    
+    // Get some parameters from the printout, if defined
+    int fromPage, toPage;
+    int minPage, maxPage;
+    printout->GetPageInfo(&minPage, &maxPage, &fromPage, &toPage);
+
+    if (maxPage == 0) return false;
+
+    // Only set min and max, because from and to will be
+    // set by the user
+    m_printDialogData.SetMinPage(minPage);
+    m_printDialogData.SetMaxPage(maxPage);
+    
     if (m_printDialogData.GetMinPage() < 1)
         m_printDialogData.SetMinPage(1);
     if (m_printDialogData.GetMaxPage() < 1)
         m_printDialogData.SetMaxPage(9999);
-
+    
     // Create a suitable device context
     wxPrinterDC *dc = NULL;
     if (prompt)
@@ -526,23 +539,7 @@
     wxBeginBusyCursor();
 
     printout->OnPreparePrinting();
-
-    // Get some parameters from the printout, if defined
-    int fromPage, toPage;
-    int minPage, maxPage;
-    printout->GetPageInfo(&minPage, &maxPage, &fromPage, &toPage);
-
-    if (maxPage == 0)
-    {
-        wxEndBusyCursor();
-        return false;
-    }
-
-    // Only set min and max, because from and to have been
-    // set by the user
-    m_printDialogData.SetMinPage(minPage);
-    m_printDialogData.SetMaxPage(maxPage);
-
+    
     printout->OnBeginPrinting();
 
     bool keepGoing = true;
</pre>

<br/><br/>Example terminal commands to build wx (read the instructions that come with wxWidgets or wxWiki for more info):<br/>
<blockquote>
<pre>cd wxMac2.8.x
mkdir osx-build && cd osx-build
../configure --with-libjpeg=builtin --with-libpng=builtin --with-regex=builtin --with-libtiff=builtin
     --with-zlib=builtin --with-expat=builtin --with-opengl --enable-unicode --disable-shared
make
sudo make install</pre></blockquote>Make sure <i>wx-config --libs</i> points to the 2.8 libs when run from a terminal. Mac OS X 10.4 comes with wxWidgets 2.5 pre-installed. It is <b>not</b> recommended to build Aria with it. If you install wxWidgets 2.8 from source, it will default to installing in /usr/local, however pre-installed 2.5 is in /usr, so be careful about conflicts. If /usr comes before /usr/local in yout PATH environment variable, you  will get the 2.5 libs. For getting 2.5 out of the way quickly, just get /usr/bin/wx-config out of the way (sudo mv /usr/bin/wx-config /usr/bin/wx-config-2.5). If your computer does not find wx-config, make sure /usr/local/bin is in your PATH (or pass WXCONFIG=/usr/local/bin/wx-config to scons - see explainations below).
<br/><br/>

<center><b>Installing wxWidgets - Linux</b></center>

You can simply download wxWidgets 2.8 from your distribution's repositories. It needs OpenGL support enabled if you want to use the OpenGL renderer, and should be Unicode. Don't forget to install -dev packages if your distribution uses them.
<br/><br/>If you want to build wxWidgets from source, you can use commands like (read the instructions that come with wxWidgets or wxWiki for more info):<br/>
<blockquote>
<pre>cd wxGTK2.8.x<br/>mkdir gtk-build && cd gtk-build<br/>../configure --with-opengl --enable-unicode<br/>make<br/>sudo make install</pre></blockquote>

Make sure <i>wx-config --libs</i> points to the 2.8 libs when run from a terminal. If it does not, it is likely that your distribution's wxWidgets (in /usr/) is picked up before the one you built (in /usr/local/). To fix this, you can pass WXCONFIG=/usr/local/bin/wx-config to scons when building - more info below.
<br/><br/>

<center><b>building libjdkmidi (any platform)</b></center>

Then you need to build libjdkmidi - its source is included with Aria however it is built seperately.<br/>
<blockquote>
<pre>
cd /path/to/Aria/Src
cd libjdkmidi
./configure
make
cd ..
</pre>
</blockquote>

<center><b>Compiling Aria (any platform)</b></center>
You are now ready to build Aria itself. All you need to do is type the command appropriate for your system :<br/>

<blockquote><pre>
python scons/scons.py
</pre><br/></blockquote>

This will do a release build with default wxWidgets. Issue <i>python scons/scons.py --help</i> for a summary of all possible options, like to get a debug build or to use a different wxWidgets build.
<br/><br/>

<b><center>Finishing on OS X</center></b>

You can make a mac OS X app bundle with the following command:
<blockquote><pre>
python scons/scons.py install
</pre></blockquote>
<br/>

<b><center>Finishing on Linux</center></b>

At this point, if you are happy with letting Aria live in this folder, you can simply run it with <i>./Aria</i>

<br/><br/>

You can also install Aria into /usr/local/ by running the following command as root :

<blockquote><pre>python scons/scons.py install </pre></blockquote>

This will require scons 0.98.4 or later to work correctly.<br/>
Or, to specify an install prefix :

<blockquote><pre>
python scons/scons.py install prefix=/usr/
</pre></blockquote>

You can uninstall it later if you want with
<blockquote><pre>
python scons/scons.py uninstall prefix=/usr
</pre></blockquote>

Don't forget to specify the prefix it was installed into if it is not the default one.<br/><br/>

If it is not already the case, you will need to install a softsynth like Timidity configured with flags : <blockquote><pre>./configure --enable-audio=alsa --enable-server --enable-alsaseq</pre></blockquote> and a soundbank, and run it as Alsa daemon with commands (in the case of Timidity) :

<blockquote><pre>
sudo modprobe snd-seq-midisudo timidity -iA -B2,8 -Os -EFreverb=0
</pre></blockquote>
-EFreverb=0 disables reverbering because it tends to cause problems, but you can leave that part out if you computer is very fast.<br/><br/>

Then, to open Aria, type <i>Aria</i> in a terminal - enjoy!

<br/><br/><br/><br/>
If you have any question or issue, do not hesitate to contact me!

</body>
</html>